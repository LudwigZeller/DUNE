####################################
# Subprogram MakeDLogo of DUNE
#
# Auto generated via makeproj ver 1.2_beta
#  David Schoosleitner (c) 2022
####################################

### COMPILER DEFINITIONS ###

## Custom checks
ifeq ($(name),)
$(error Define name)
endif
ifeq ($(outputname),)
$(error Define outputname)
endif
ifeq ($(targetpng),)
$(error Define targetpng)
endif

# Generated by C++ makeproj include
CXX := g++

# Generated by debug makeproj
GDB := gdb

### DIRECTORY DEFINITIONS ###

BUILD_DIR := ../../../90_BUILD/gmake/$(name)

# Generated by debug makeproj include
DEBUG_DIR := $(BUILD_DIR)/debug

SOURCE_DIR := ./

### BUILD ARG DEFINITIONS ###

OUTPUT_FILE := $(BUILD_DIR)/$(outputname)

CCFLAGS := -I/usr/local/include/opencv4 -L/usr/local/lib -I$(SOURCE_DIR)/../../dependencies/glad/include
OPENCV_FLAGS := -lopencv_calib3d \
-lopencv_core \
-lopencv_dnn \
-lopencv_features2d \
-lopencv_flann \
-lopencv_gapi \
-lopencv_highgui \
-lopencv_imgcodecs \
-lopencv_imgproc \
-lopencv_ml \
-lopencv_objdetect \
-lopencv_photo \
-lopencv_stitching \
-lopencv_video \
-lopencv_videoio

DECL_FLAG := -D_PATH_PNG="../$(targetpng).png" -D_PATH_RES="../$(targetpng).dres" -D_RES_NAME="$(name)"

### SOURCE/OBJ DEFINITIONS ###

# Check if sources not empty
ifeq ($(SOURCES),)
$(error Define SOURCES)
endif

# Sources relocation into 70_DEV
SRC_DEV := $(SOURCES:%=$(SOURCE_DIR)/%)

# Objects relocation into 90_BUILD
OBJS := $(SOURCES:%=$(BUILD_DIR)/%.o)

# Generated by debug makeproj include
# Debug Objects relocation into 90_BUILD/debug
OBJ_DEBUG := $(SOURCES:%=$(DEBUG_DIR)/%.o)

### SCRIPTS ###

default: $(BUILD_DIR) $(OBJS)
	$(CXX) $(DECL_FLAG) -o $(OUTPUT_FILE) $(OBJS) $(CCFLAGS) $(OPENCV_FLAGS) -DPRODUCTION_MODE=1

$(BUILD_DIR):
	mkdir -p $(BUILD_DIR)

# Generated by debug makeproj include
$(DEBUG_DIR): $(BUILD_DIR)
	mkdir -p $(DEBUG_DIR)

# Generated by debug makeproj include
debug: $(DEBUG_DIR) $(OBJ_DEBUG)
	$(CXX) $(DECL_FLAG) -o $(OUTPUT_FILE)_gdb $(OBJ_DEBUG) $(CCFLAGS) $(OPENCV_FLAGS) -g

$(BUILD_DIR)/%.cpp.o: $(SOURCE_DIR)/%.cpp
	$(CXX) $(DECL_FLAG) -o $@ -c $< $(CCFLAGS) $(OPENCV_FLAGS) -DPRODUCTION_MODE=1 

# Generated by debug makeproj include
$(DEBUG_DIR)/%.cpp.o: $(SOURCE_DIR)/%.cpp
	$(CXX) $(DECL_FLAG) -o $@ -c $< $(CCFLAGS) $(OPENCV_FLAGS) -g

clean: $(BUILD_DIR)
	-@rm -r -f $(BUILD_DIR)/*
	-@rm -r -f $(OUTPUT_FILE)
	-@rm -r -f $(OUTPUT_FILE)_gdb
	@echo "Deleted $(BUILD_DIR) and $(OUTPUT_FILE)"

# Generated by run makeproj include
run: default
	./$(OUTPUT_FILE) $(args)

# Generated by run and debug makeproj include
rundebug: debug
	$(GDB) $(OUTPUT_FILE)_gdb

